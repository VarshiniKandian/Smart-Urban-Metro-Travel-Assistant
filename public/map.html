<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Metro Navigator</title>
    <link rel="stylesheet" href="map-style.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <button id="menuButton" aria-label="Open menu">&#9776; MENU</button>
    <div id="menuSidebar" class="sidebar">
        
        <div class="sidebar-welcome-header">
            <p id="welcomeMessage">Welcome!</p>
        </div>
        
        <ul>
            <li onclick="window.location.href='history.html'">Travel History</li>
            <li onclick="window.location.href='stats.html'">View Analytics</li>
            
            <li><h3>Navigation</h3></li>
            
            <li onclick="window.location.href='instructions.html'">Instructions</li>
            
            <li class="sidebar-user-info profile-bottom-section">
                <span id="profileIcon">ðŸ‘¤</span>
                <p id="userDisplay"></p> </li>
            
            <li class="sidebar-logout" id="sidebarLogoutBtn">
                <button class="danger-action-btn" style="width: 90%;">Logout</button>
            </li>
        </ul>
    </div>

    <div class="top-right">
    </div>

    <div class="controls" role="region" aria-label="Route controls">
        <div class="route-controls">
            <select id="city" aria-label="Select city">
                <option value="" disabled selected>Select City</option>
                <option value="hyderabad">Hyderabad</option>
                <option value="chennai">Chennai</option>
                <option value="bengaluru">Bengaluru</option>
                <option value="mumbai">Mumbai</option>
                <option value="jaipur">Jaipur</option>
            </select>

            <select id="from" aria-label="From station">
                <option value="" disabled selected>From Station</option>
            </select>

            <select id="to" aria-label="To station">
                <option value="" disabled selected>To Station</option>
            </select>
        </div>

        <div class="journey-controls">
            <button id="findRoute">Start Journey</button>
            <button id="endJourney">End Journey</button>
        </div>
    </div>

    <div id="map"></div>
    
    <p id="estimatedTimeDisplay">Estimated Time: --</p>

    <script src="alerts.js"></script>
    <script src="auth-check.js"></script>
    <script src="route-logic.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const menuButton = document.getElementById('menuButton');
            const sidebar = document.getElementById('menuSidebar');
            const sidebarLogoutBtn = document.getElementById('sidebarLogoutBtn');

            sidebarLogoutBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                window.handleLogout && window.handleLogout();
            });

            menuButton.addEventListener('click', (e) => {
                e.stopPropagation();
                
                // Reset animations by removing and re-adding active class
                if (!sidebar.classList.contains('active')) {
                    // Remove animations first
                    const menuItems = sidebar.querySelectorAll('li');
                    menuItems.forEach(item => {
                        item.style.animation = 'none';
                    });
                    
                    // Force reflow
                    void sidebar.offsetWidth;
                    
                    // Add active class to trigger animations
                    sidebar.classList.add('active');
                    
                    // Re-enable animations
                    setTimeout(() => {
                        menuItems.forEach(item => {
                            item.style.animation = '';
                        });
                    }, 10);
                } else {
                    sidebar.classList.remove('active');
                }
            });

            document.getElementById('map').addEventListener('click', () => {
                sidebar.classList.remove('active');
            });

            sidebar.querySelectorAll('li').forEach(item => {
                item.addEventListener('click', (e) => {
                    if (e.target.tagName !== 'BUTTON' && e.target.tagName !== 'A') {
                        setTimeout(() => {
                            sidebar.classList.remove('active');
                        }, 200);	
                    }
                });
            });
            
            // Global cleanup function for persistent modals on navigation/unload
            window.addEventListener('beforeunload', () => {
                document.querySelectorAll('.alert-overlay').forEach(el => {
                    el.remove();
                });
            });
        });
    </script>
</body>
</html>